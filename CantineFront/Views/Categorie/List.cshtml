<div class="container-fluid p-4">
    <!-- Header Section -->
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h2 class="h4 mb-0 text-primary">
                        <i class="fas fa-tags me-2"></i>Gestion des Catégories
                    </h2>
                    <p class="text-muted mb-0">Gérez les catégories de votre restaurant d'entreprise</p>
                </div>
                <div class="col-md-6 text-end">
                    <a class="btn btn-primary btn-lg px-4" href="/Categorie/Create">
                        <i class="fas fa-plus-circle me-2"></i>Nouvelle Catégorie
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- DataTable Card -->
    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0" id="tbCategories" style="width:100%">
                    <thead class="table-light">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">
                               Nom de la Catégorie
                            </th>
                            <th scope="col" class="text-center">
                               Statut
                            </th>
                            <th scope="col" class="text-center">
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Loading Spinner -->
<div id="loadingSpinner" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Chargement...</span>
    </div>
    <p class="text-muted mt-2">Chargement des catégories...</p>
</div>

@section Styles {
   <link rel="stylesheet" href="~/css/categorie.css"/>
}

@section Scripts {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="text/javascript">
        $(function () {
            // Show loading spinner
            $('#loadingSpinner').show();

            var successHandler = function (res) {
                console.log(JSON.stringify(res));
                $('#loadingSpinner').hide();

                if (res) {
                    if (res.success) {
                        ToastR(res.message, res.status, 15);

                        $('#tbCategories').DataTable({
                            data: res.data,
                            responsive: true,
                            destroy: true,
                            language: {
                                "zeroRecords": "<div class='dataTables_empty'><i class='fas fa-inbox'></i><br>Aucune catégorie trouvée</div>",
                                "emptyTable": "<div class='dataTables_empty'><i class='fas fa-inbox'></i><br>Aucune donnée disponible</div>",
                                "info": "Affichage de _START_ à _END_ sur _TOTAL_ catégories",
                                "infoEmpty": "Affichage de 0 à 0 sur 0 catégories",
                                "infoFiltered": "(filtrées depuis _MAX_ catégories au total)",
                                "lengthMenu": "Afficher _MENU_ catégories",
                                "search": "<i class='fas fa-search'></i>",
                                "paginate": {
                                    "first": "<i class='fas fa-angle-double-left'></i>",
                                    "last": "<i class='fas fa-angle-double-right'></i>",
                                    "next": "<i class='fas fa-angle-right'></i>",
                                    "previous": "<i class='fas fa-angle-left'></i>"
                                }
                            },
                            columns: [
                                {
                                    // width: '5%',
                                    data: null,
                                    render: function (data, type, row, meta) {
                                        return '<span class="text-muted">' + (meta.row + 1) + '</span>';
                                    }
                                },
                                {
                                    // width: '40%',
                                    data: 'name',
                                    render: function (data, type, row) {
                                        return '<div class="d-flex align-items-center">' +
                                               '<i class="fas fa-tag text-primary me-3"></i>' +
                                               '<span class="fw-semibold">' + data + '</span>' +
                                               '</div>';
                                    }
                                },
                                {
                                    data: "actif",
                                    className: 'text-center',
                                    render: function (data, type, row) {
                                        var className = (data == true ? "badge-success" : "badge-danger");
                                        var status = (data == true ? "actif" : "inactif");
                                        var icon = (data == true ? "fa-check-circle" : "fa-times-circle");

                                        return '<div class="d-flex justify-content-center align-items-center">' +
                                               '<i class="fas ' + icon + ' me-2"></i>' +
                                               '<span class="badge ' + className + '">' + status + '</span>' +
                                               '</div>';
                                    }
                                },
                                {
                                    data: null,
                                    width: '25%',
                                    className: 'text-center',
                                    render: function (data, type, row) {
                                        var btnEdit = '<a class="btn btn-action btn-edit me-2" href="/Categorie/Update/' + row.id + '" title="Modifier">' +
                                                     '<i class="fas fa-edit me-1"></i> Modifier</a>';

                                        var btnDelete = '<button type="button" class="btn btn-action btn-delete" ' +
                                                       'data-method="DELETE" ' +
                                                       'data-message="Voulez-vous vraiment supprimer la catégorie <b>' + row.name + '</b> ?" ' +
                                                       'data-url="/Categorie/DeleteCategorie/' + row.id + '" ' +
                                                       'data-toggle="modal" data-target="#confirmModal" ' +
                                                       'title="Supprimer">' +
                                                       '<i class="fas fa-trash me-1"></i> Supprimer</button>';

                                        return '<div class="d-flex justify-content-center">' + btnEdit + btnDelete + '</div>';
                                    }
                                }

                            ],
                            initComplete: function () {
                                // Add custom styling after table initialization
                                $('.dataTables_filter label').addClass('d-flex align-items-center');
                                $('.dataTables_filter input').attr('placeholder', 'Rechercher une catégorie...');
                            },
                            drawCallback: function () {
                                // Re-initialize tooltips
                                $('[title]').tooltip();
                            }
                        });

                    } else {
                        ToastR(res.message, res.status, 15);
                    }
                }
            }

            var errorHandler = (err) => {
                $('#loadingSpinner').hide();
                ToastR("Une erreur a été rencontrée lors du chargement des catégories", "error", 15);
                console.error(err);
            }

            ajaxManager('GET', '/Categorie/GetCategories', successHandler, errorHandler);
        });
    </script>
}